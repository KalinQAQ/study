

在上一节中我们介绍了目录的划分，在我们项目的根目录下会有一个 `website` 文件夹用来建设项目的官网。通常一个成功的项目需要有一个对应的文档站，用来向用户使用你的开源库提供指导以及增强社区的参与。在本节中会介绍如何搭建并部署属于你的文档站。

为了更有效地聚焦于开源库的编写，而非从头开始构建文档站，`Docusaurus` 提供了一个理想的解决方案。它使得开发者能够专注于内容创作，无需关注复杂的搭建过程。使用 `Docusaurus`，开发者只需编写 Markdown 文件，即可轻松构建和维护文档网站。

像很多我们熟悉的很多库的官方网站都是基于 [`Docusaurus`](https://github.com/facebook/docusaurus) 搭建的，例如：


|  | 文档站 | 代码仓库 |
| --- | --- | --- |
| redux | https://react-redux.js.org/ | https://github.com/reduxjs/react-redux/tree/master/website |
| jest | https://jestjs.io/ | https://github.com/jestjs/jest/tree/main/website |
| prettier | https://prettier.io/ | https://github.com/prettier/prettier/tree/main/website |
| create-react-app | https://create-react-app.dev/ | https://github.com/facebook/create-react-app/tree/main/docusaurus/website |



以及[其他案例](https://docusaurus.io/zh-CN/showcase?tags=favorite)，数不胜数。

`Docusaurus` 具有上手简单、多语言支持、搜索引擎优化友好、优秀的响应式设计等特性。在本节中我们会讲解如何基于 `Docusaurus` 搭建属于我们的文档站，并将其部署到 `Vercel` 上。




## Docusaurus 快速入门

首先，我们在根目录下执行：


```js
npx create-docusaurus@latest website classic
```

执行 `npx` 运行一个命令时，如果没有安装则 npx 会临时帮助我们安装这个包，执行完毕以后会将其删除。

其中，`create-docusaurus` 是一个命令行工具，用于快速创建 Docusaurus 项目，`classic` 是一个预设模板，包含了标准文档、博客、自定义页面及 CSS 框架（支持暗黑模式），可以更快地生成一个网站。

**启动：**

```js
cd website  
npm run start
```



<p align=center><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ccd25dd31fcd474bbd60829a983afa5d~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2878&h=1644&s=272389&e=png&b=ffffff" alt="image.png"  /></p>



现在我们已经可以看到网站运行起来了。Docusaurus are cool！在项目的 `website/` 目录下可以看到以下文件：


```js
website
├── blog
│   ├── 2021-08-26-welcome
│   │   ├── docusaurus-plushie-banner.jpeg
│   │   └── index.md
│   ├── 2019-05-28-first-blog-post.md
│   ├── 2019-05-29-long-blog-post.md
│   ├── 2021-08-01-mdx-blog-post.mdx
│   └── authors.yml
├── docs
│   ├── doc1.md
│   ├── doc2.md
│   ├── doc3.md
│   └── mdx.md
├── src
│   ├── css
│   │   └── custom.css
│   └── pages
│       ├── styles.module.css
│       └── index.js
├── static
│   └── img
├── docusaurus.config.js
├── package.json
├── README.md
├── sidebars.js
└── yarn.lock
```

通过目录名称其实就可以大致猜出每个部分的作用，但仍然有必要对其中一些配置做一下描述，其中：

- `/blog/`：包含博客的 Markdown 文件，对应这部分：

<p align=center><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/70bb3d66c15e403eaa7a80b89c6c2a51~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2872&h=1608&s=1274425&e=png&b=fefdfd" alt="image.png"  /></p>

每一个 Markdown 文件对应了一篇博文，在文件顶端我们可以看到这样的内容：


```js
---
slug: first-blog-post
title: First Blog Post
authors:
  name: Gao Wei
  title: Docusaurus Core Team
  url: https://github.com/wgao19
  image_url: https://github.com/wgao19.png
tags: [hola, docusaurus]
---
```

我们称之为 front matter（前言），通常 Docusaurus 可以自动通过配置或者内容推断信息，而 front matter 可以用来丰富更多信息。其中 `slug` 用来指定博客的 URL，比如上面的 `first-blog-post` 对应路径就是 `/blog/first-blog-post`，如果不提供则使用文件名，其他的都比较好理解。


- `/docs/`：包含文档的 Markdown 文件，对应这部分：


<p align=center><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7ea4cce36a3a4c7eb332b7ba11a18516~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2876&h=1478&s=342985&e=png&b=ffffff" alt="image.png"  /></p>

Docusaurus 会根据文件结构自动生成目录结构，每个文件夹会生成一个类别，每个文件会生成一个文档链接：

<p align=center><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0cf0092a58304c97b9b8b26886ec7d81~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2042&h=1030&s=289556&e=png&b=fefefe" alt="image.png"  /></p>

在每个目录下可以发现包含一个 `_category_.json` 文件，用来声明元数据:


```js
{
  "label": "Tutorial - Extras",
  "position": 3,
  "link": {
    "type": "generated-index"
  }
}
```

比如说这个 `_category_.json` 配置文件中 `label` 指定了标题，`position` 指定了其在侧边栏中的位次，`link` 指定了当用户点击该分类标题时应该展示的内容，`type` 指定 `generated-index` 代表跳转到 Docusaurus 自动生成的介绍文档：


<p align=center><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/59369bbf7c4543ae94fce1c22a10c14a~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2874&h=1410&s=304337&e=png&b=fefefe" alt="image.png"  /></p>

如果你希望点击展示某一篇文章，可以改为：


```js
"link": {
  "type": "doc",
  "id": "deploy-your-site"
}
```

<p align=center><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1c5aad093e9f4dbfa43da1fc13aed2c1~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2878&h=1462&s=277710&e=png&b=ffffff" alt="image.png"  /></p>


- `/src/`：页面或自定义 React 组件一类的非文档文件，其中 `/src/pages` 目录中的 JSX/TSX/MDX 文件都会被转换成网站页面，比如网站首页对应了`src/pages/index.js`文件。
- `/static/`：静态目录。 此处的所有内容都会被复制进 `build` 文件夹。
- `/docusaurus.config.js`：站点配置文件。
- `/sidebars.js`：用于配置侧边栏，分为[自动生成](https://docusaurus.io/zh-CN/docs/next/sidebar/autogenerated)和[手动配置](https://docusaurus.io/zh-CN/docs/next/sidebar/items#sidebar-item-category)。

自动生成前面提到了 Docusaurus 可以根据你的文件系统结构自动生成侧边栏：


```js
tutorialSidebar: [{type: 'autogenerated', dirName: '.'}],
```
即 `type` 需要指定为 `autogenerated`，`dirName` 为生成侧边栏文件夹的路径。

当然也可手动生成：

`type: "doc"`：用来跳转具体文档，有两种写法：


```js
tutorialSidebar: [
  // 简写
  "intro",
  // 通用写法
  {
    type: "doc",
    label: "Tutorial Intro",
    id: "intro",
  },
],
```

`type: "category"`：创建侧边栏下拉菜单。


```js
tutorialSidebar: [
  {
    type: "category",
    label: "Tutorial",
    items: ["tutorial-basics/create-a-document"],
  },
],
```


`type: "link"`：点击跳转到另一个页面，可以链接到网站内部或外部网站。


```js
tutorialSidebar: [
  {
    type: "link",
    label: "掘金",
    href: "https://juejin.cn/",
  },
  {
    type: "link",
    label: "Home",
    href: "/",
  },
],
```

`type: "html"`：甚至可以在当前位置渲染一个纯 HTML，例如我想增加一个可以跳转到掘金的标签：


```js
tutorialSidebar: [
  {
    type: "html",
    value: '<a target="_blank" href="https://juejin.cn/">掘金</a>', // The HTML to be rendered
    defaultStyle: true, // Use the default menu item styling
  },
],
```


当然也可以混合使用，例如在最后增加一个 `link`：


```js
tutorialSidebar: [
  { type: "autogenerated", dirName: "." },
  {
    type: "link",
    label: "掘金", // The link label
    href: "https://juejin.cn/", // The external URL
  },
],
```



<p align=center><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0068e09a651b4ea8b2efb640c4b0acd0~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=600&h=334&s=23473&e=png&b=fcfcfc" width="50%" alt="image.png"  /></p>





## 文档站中集成搜索能力

通常我们会在这些文档站中看到搜索功能，方便我们进行一些查询：


![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ae7b13e5182b46998deb095f92b93c34~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2878&h=1608&s=903195&e=png&b=f8f7f7)

那搜索能力又是如何构建的呢？接下来带大家使用官方维护的 Algolia DocSearch 来实现文档站的搜索能力。

整个过程可以分为以下几个部分：

1. **集成 DocSearch**：默认是没有搜索功能的，因此我们需要先在项目中集成 Algolia DocSearch。
2. **爬取内容**：之后 Algolia DocSearch 每周（可以调整）爬取一次我们的网站内容，并把这些文本内容存储在 Algolia 的服务器上。
3. **搜索查询**：当用户在 Docusaurus 网站上搜索内容时，请求被发送到 Algolia，Algolia 会处理这个请求并返回内容。
4. **显示结果**：最后 Docusaurus 会把搜索结果展示给用户。

可以看到整个过程依赖网络交互，你可能会问：为什么不直接在本地搜索文档，而是要请求 Algolia 服务器呢？

当然本地搜索也是可以的，但这更适合小型网站，一旦我们网站的内容变得更加丰富，本地搜索可能就会因为性能瓶颈而没有办法非常快速地提供结果。而 Algolia 的服务器专门为高效搜索而优化，能够处理大规模的数据集并快速返回搜索结果。

首先我们需要先向 Algolia [申请](https://docsearch.algolia.com/apply/) 来获取 Algolia index 和 API key。

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a37fc30341a94721854ae7654241b61f~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2878&h=1606&s=566502&e=png&b=ffffff)

然后等个几天你就会收到 Algolia 的回复邮件（我这里等了 4 天），包含了 appId、apiKey、indexName 信息，之后将这些信息配置到 `docusaurus.config.js` 文件中：


```js
export default {
  // ...
  themeConfig: {
    // ...
    algolia: {
      appId: 'YOUR_APP_ID',
      apiKey: 'YOUR_SEARCH_API_KEY',
      indexName: 'YOUR_INDEX_NAME',
      },
    },
  },
};
```

更多参数参考 [Algolia 官方文档](https://docsearch.algolia.com/docs/api/#searchparameters)。
配置好之后，我们就可以在右上角看到搜索栏了：

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/05256a8c59a340969def00b02fd7fcce~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2876&h=1626&s=522719&e=png&b=ffffff)

然后，你就可以安静等待我们的网站被 Algolia 爬虫爬取。当然你也可以主动触发爬虫搜索：


![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d3c75241dbcc4131a065524b894e63c4~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2858&h=1612&s=365851&e=png&b=f8f8fb)

接下来，我们的搜索能力就可以正常工作了！

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/963aed3d9145420b9d5cdabec9b5d7ba~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2874&h=1614&s=331137&e=png&b=83889d)




## Vercel 部署


为了使得我们的文档站能够被别人访问，我们需要将网站部署到 Web 服务器上。当然有很多方法可以做到，我们这里选择官方推荐的 Vercel 作为案例来演示整个部署过程。


首先我们需要确保已经把项目推送到 GitHub 上。然后打开[Vercel 官网](https://vercel.com/)，没有登录的用 Github 帐号登录一下，然后导入仓库内的项目：


<p align=center><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/77ecb605998749978b0b5d18cc448d4c~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2878&h=1616&s=299827&e=png&b=fcfcfc" alt="image.png"  /></p>

然后就跳转到这个界面：

<p align=center><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/10590160500e45d28f41672efc5853b6~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2878&h=1626&s=265109&e=png&b=fdfdfd" alt="image.png"  /></p>

由于我们的文档站代码是位于 `website` 目录下，因此我们需要指定 Root Directory：


<p align=center><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/67d39fb7c8e1468796bc21fdb642c5c2~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2876&h=1574&s=292548&e=png&b=cccccc" alt="image.png"  /></p>


其他选项采用默认就可以，点击 Deploy 即可开始部署项目：

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b597357d044f4cbe80825df4f8932547~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2878&h=1610&s=716805&e=png&b=fcfcfc)

恭喜你完成了文档站的部署！点击左侧页面预览可以访问部署好的网站。Vercel 默认会为你分配一个域名，比如我们这个域名是 https://state-management-collection.vercel.app/ ，当然在国内是没有办法直接访问的，因为域名被 DNS 污染了，可以到 https://tool.chinaz.com/dnsce 查看情况：


![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/92d32b0f2ec8463bb4d2fd700866fc69~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2416&h=1424&s=461311&e=png&b=ffffff)


那如何让国内也可以访问这个网站呢？
你需要单独购买一个并将域名解析到你的网站，我这里是在[阿里云](https://wanwang.aliyun.com/domain)上购买的。


![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b814aa11cb824c299adb9ee972d4b662~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1540&h=1608&s=162067&e=png&b=fefefe)

这里需要配置一下 CNAME，CNAME 的作用是将一个域名映射到另一个域名上，记录值指向 `cname-china.vercel-dns.com`，打开 https://juejin.q-u-n.com/, 现在已经可以在国内正常访问了。

Vercel 也提供自动化的持续部署（CD）能力，也就是说每次提交代码到仓库都会触发自动部署流程，会根据不同分支构建成产环境或预览环境（https://vercel.com/docs/deployments/git ）。


<p align=center><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/13e3b63487914993bf3e6a4226d9e1ef~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2878&h=1124&s=223835&e=png&b=fcfcfc" alt="image.png"  /></p>

当然你可能会想需不需要花钱，Vercel 提供了一个免费的 [Hobby 计划](https://vercel.com/docs/limits/overview)，例如每月 100GB 的带宽等，当然这对于个人网站来说肯定足够用了。



## 总结

所见即所得，通过 Docusaurus 我们只需要关心真正的文档内容而并非网站本身，借助 Docusaurus 与 Vercel 只需要简单的一些配置就可以生成和部署精美的网站。

通过本文你可以学习到

- Docusaurus 基本使用及如何在文档站中集成搜索能力。
- 如何使用 Vercel 部署你的文档站。
